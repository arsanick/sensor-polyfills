<!DOCTYPE html>
<html>
<head>
<title>Sensor Data</title>
</head>
<body>

</h1>Sensor Data </h1>
</h2>Accelerometer Data</h2>

<div id="acceleration-data">
  <p>Acceleration X: <span id="accel-x">0</span></p>
  <p>Acceleration Y: <span id="accel-y">0</span></p>
  <p>Acceleration Z: <span id="accel-z">0</span></p>
</div>

</h2>Geolocation Data</h2>

<div id="geolocation-data">
    <p>Latitude: <span id="latitude">0</span></p>
    <p>Longitude: <span id="longitude">0</span></p>
</div>

</h2>Absolute Orientation Data</h2>

<div id="orientation-data">
  <p>Absolute Orientation Quaternion:</p>
  <p>X: <span id="quat-x">0</span></p>
  <p>Y: <span id="quat-y">0</span></p>
  <p>Z: <span id="quat-z">0</span></p>
  <p>W: <span id="quat-w">0</span></p>
  <p>Roll: <span id="roll">0</span></p>
  <p>Pitch: <span id="pitch">0</span></p>
  <p>yaw: <span id="yaw">0</span></p>
</div>


<script type="module">
// Assuming you have a working implementation of the Accelerometer sensor
import { Accelerometer } from './src/motion-sensors.js';
// Import the AbsoluteOrientationSensor class
import { AbsoluteOrientationSensor } from './src/motion-sensors.js'; // Replace with the actual path to your implementation

// Function to convert quaternion to Euler angles in degrees
function quaternionToEuler(q) {
  const x = q[0], y = q[1], z = q[2], w = q[3];

  // Roll (x-axis rotation)
  const roll = Math.atan2(2 * (w * x + y * z), 1 - 2 * (x * x + y * y));

  // Pitch (y-axis rotation)
  let pitch = Math.asin(2 * (w * y - z * x));

  // Yaw (z-axis rotation)
  let yaw = Math.atan2(2 * (w * z + x * y), 1 - 2 * (y * y + z * z));

  // Convert radians to degrees
  const rollDeg = roll * 180 / Math.PI;
  const pitchDeg = pitch * 180 / Math.PI;
  const yawDeg = yaw * 180 / Math.PI;

  return { roll: rollDeg, pitch: pitchDeg, yaw: yawDeg };
}

// Options for the AbsoluteOrientationSensor
const options = { frequency: 60, referenceFrame: "device" };

// Create a new AbsoluteOrientationSensor instance
const sensor = new AbsoluteOrientationSensor(options);

// Event listener for reading the sensor data
sensor.addEventListener("reading", () => {
  // Access the quaternion data
  const quaternion = sensor.quaternion;
    // Convert quaternion to Euler angles
  const eulerAngles = quaternionToEuler(quaternion);
  // Update the orientation data on the page
  document.querySelector('#quat-x').textContent = quaternion[0].toFixed(3);
  document.querySelector('#quat-y').textContent = quaternion[1].toFixed(3);
  document.querySelector('#quat-z').textContent = quaternion[2].toFixed(3);
  document.querySelector('#quat-w').textContent = quaternion[3].toFixed(3);
    // Update the orientation data on the page
  document.querySelector('#roll').textContent = eulerAngles.roll.toFixed(2);
  document.querySelector('#pitch').textContent = eulerAngles.pitch.toFixed(2);
  document.querySelector('#yaw').textContent = eulerAngles.yaw.toFixed(2);
});

// Event listener for handling errors
sensor.addEventListener("error", (event) => {
  if (event.error.name === "NotReadableError") {
    console.log("Sensor is not available.");
  }
});

// Start the orientation sensor
sensor.start();

// Create a new Accelerometer instance
let accel = new Accelerometer({ frequency: 60 });

// Handle errors
accel.onerror = err => console.error(err);

// Handle readings
accel.onreading = (event) => {
  const sensor = event.target;

  // Update the acceleration data on the page
  document.querySelector('#accel-x').textContent = sensor.x.toFixed(2);
  document.querySelector('#accel-y').textContent = sensor.y.toFixed(2);
  document.querySelector('#accel-z').textContent = sensor.z.toFixed(2);
};

// Start the accelerometer
accel.start();

// Geolocation code
if ("geolocation" in navigator) {
  /* geolocation is available */
  navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
} else {
  /* geolocation IS NOT available */
  console.error("Geolocation is not available");
}

function successCallback(position) {
  document.querySelector('#latitude').textContent = position.coords.latitude.toFixed(2);
  document.querySelector('#longitude').textContent = position.coords.longitude.toFixed(2);
}

function errorCallback(error) {
  alert(`ERROR(${error.code}): ${error.message}`);
}
</script>

</body>
</html>